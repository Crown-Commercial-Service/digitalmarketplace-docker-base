FROM digitalmarketplace/base

COPY nginx/frontend /etc/nginx/sites-enabled/frontend

ONBUILD RUN python -m venv venv
ONBUILD COPY requirements.txt ${APP_DIR}
ONBUILD RUN venv/bin/pip install --no-cache-dir -r requirements.txt

ONBUILD COPY package.json ${APP_DIR}
ONBUILD COPY yarn.lock ${APP_DIR}
ONBUILD RUN yarn install --pure-lockfile

ONBUILD COPY . ${APP_DIR}

ONBUILD RUN ./scripts/build.sh

ONBUILD ARG release_name
ONBUILD RUN echo ${release_name} > ${APP_DIR}/version_label
