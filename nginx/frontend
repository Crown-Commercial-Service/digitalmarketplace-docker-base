server {
    listen {PORT};

    location ~ ^(?:/[-a-z/]+)?/static/(.+)$ {
        alias /app/app/static/$1;

        add_header Cache-Control 'public max-age=3600';
    }

    location ~ ^(?:/[-a-z/]+)?/(_status|_metrics)$ {
        include uwsgi_params;
        uwsgi_pass unix:///run/uwsgi.sock;
    }

    location / {
        auth_basic "Restricted";
        auth_basic_user_file "/etc/nginx/.htpasswd";
        include uwsgi_params;
        uwsgi_pass unix:///run/uwsgi.sock;
    }
}
