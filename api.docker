FROM digitalmarketplace/base

COPY nginx/api /etc/nginx/sites-enabled/api

ENV APP_DIR=/app

ONBUILD RUN apk upgrade --no-cache && \
        python3 -m venv ${APP_DIR}/venv && \
        ${APP_DIR}/venv/bin/pip3 install --no-cache-dir --upgrade pip

ONBUILD COPY requirements.txt ${APP_DIR}
ONBUILD RUN ${APP_DIR}/venv/bin/pip3 install --no-cache-dir -r ${APP_DIR}/requirements.txt

ONBUILD COPY . ${APP_DIR}

ONBUILD ARG release_name
ONBUILD RUN echo ${release_name} > ${APP_DIR}/version_label
